<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<title>Калкулатор – Надценка/Отстъпка</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root {
    --bg: #fff;
    --text: #000;
    --card: #f9f9f9;
    --success: #0b8;
    --warning: #d33;
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --bg: #121212;
      --text: #eee;
      --card: #1e1e1e;
    }
  }
  body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 1rem; }
  .card { background: var(--card); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
  .row { display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center; }
  input, select { padding: 0.5rem; font-size: 1rem; }
  button { padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer; }
  .output { font-weight: bold; margin-top: 0.5rem; }
  .output.success { color: var(--success); }
  .output.warning { color: var(--warning); }
  .history { font-size: 0.9rem; margin-top: 1rem; }
  .history-item { border-top: 1px solid #ccc; padding: 0.5rem 0; }
</style>
</head>
<body>

<div class="card">
  <h2>Калкулатор: Надценка / Отстъпка</h2>

  <div class="row">
    <label>Сума:</label>
    <input id="amount" type="number" min="0" placeholder="0.00">
  </div>

  <div class="row">
    <label>% Надценка / Отстъпка:</label>
    <input id="percent" type="number" value="0" min="-100" max="100">
  </div>

  <div class="row">
    <label>Валута:</label>
    <select id="currency">
      <option value="BGN">BGN</option>
      <option value="EUR">EUR</option>
      <option value="USD">USD</option>
      <option value="GBP">GBP</option>
    </select>
  </div>

  <button onclick="calculate()">Изчисли</button>

  <div id="result" class="output"></div>
  <button id="copyBtn" style="display:none;">Копирай резултата</button>

  <div class="history">
    <h3>История на изчисленията:</h3>
    <div id="historyList"></div>
  </div>
</div>

<script>
// фиктивни валутни курсове – бихте могли да извличате данни от истински API
const rates = { BGN:1, EUR:1.96, USD:1.75, GBP:2.20 };
let history = [];

function calculate() {
  const amt = parseFloat(document.getElementById('amount').value) || 0;
  const pct = parseFloat(document.getElementById('percent').value) || 0;
  const cur = document.getElementById('currency').value;
  const baseBGN = amt * rates[cur];
  const finalBGN = baseBGN * (1 + pct/100);
  const final = finalBGN / rates[cur];
  const sign = pct >= 0 ? '+' : '';
  const colorClass = pct >= 0 ? 'success' : 'warning';

  const resultText = `${final.toFixed(2)} ${cur} (${sign}${pct} %)`;
  const out = document.getElementById('result');
  out.textContent = resultText;
  out.className = 'output ' + colorClass;

  document.getElementById('copyBtn').style.display = 'inline-block';
  document.getElementById('copyBtn').onclick = () => {
    navigator.clipboard.writeText(resultText);
    alert('Копирано!');
  };

  addToHistory(`${amt.toFixed(2)} ${cur} → ${resultText}`);
}

function addToHistory(text) {
  history.unshift(text);
  if (history.length > 5) history.pop();
  renderHistory();
}

function renderHistory() {
  const list = document.getElementById('historyList');
  list.innerHTML = '';
  history.forEach(item => {
    const div = document.createElement('div');
    div.className = 'history-item';
    div.textContent = item;
    list.appendChild(div);
  });
}

// При смяна на тема браузър – тук CSS автоматично сменя
</script>

</body>
</html>

